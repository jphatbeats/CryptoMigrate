openapi: 3.1.0
info:
  title: Complete Trading Intelligence API - FIXED
  description: Comprehensive trading portfolio management with live exchange data from BingX & Blofin, advanced crypto news intelligence, opportunity scanning, and AI-optimized analysis
  version: v2.1.2-FIXED
servers:
  - url: https://titan-trading-2-production.up.railway.app

paths:
  /health:
    get:
      description: Health check endpoint to verify API connectivity
      operationId: healthCheck
      responses:
        '200':
          description: API is healthy and responding
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  timestamp:
                    type: string
                  server:
                    type: string
                  version:
                    type: string
                  endpoints_available:
                    type: array
                    items:
                      type: string

  /:
    get:
      description: API documentation and available endpoints
      operationId: getApiDocumentation
      responses:
        '200':
          description: API documentation with all available endpoints
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  live_endpoints:
                    type: object
                    additionalProperties: true
                  bingx_candlestick_endpoints:
                    type: object
                    additionalProperties: true
                  chatgpt_endpoints:
                    type: object
                    additionalProperties: true
                  crypto_news_intelligence:
                    type: object
                    additionalProperties: true

  /api/positions/bingx:
    get:
      summary: "Get BingX Positions"
      description: "REQUIRED ENDPOINT: Get live BingX positions in direct array format. Always use this endpoint for position analysis. Returns empty array [] if no positions, or array of position objects with live P&L data."
      operationId: getBingXPositions
      responses:
        '200':
          description: "Direct array of BingX positions - Empty [] means no positions, Array with objects means active positions"
          content:
            application/json:
              schema:
                type: array
                description: "Direct array format for ChatGPT. Empty [] = no positions. Array with objects = active positions with P&L data."
                items:
                  type: object
                  properties:
                    symbol:
                      type: string
                      description: "Trading pair like XRP/USDT:USDT"
                      example: "XRP/USDT:USDT"
                    side:
                      type: string
                      description: "Position side: long or short"
                      example: "long"
                    contracts:
                      type: number
                      description: "Position size in contracts"
                      example: 824.0
                    entryPrice:
                      type: number
                      description: "Entry price in USDT"
                      example: 1.6341
                    markPrice:
                      type: number
                      description: "Current market price"
                      example: 3.2003
                    unrealizedPnl:
                      type: number
                      description: "CRITICAL: Current P&L in USDT. Positive = profit, Negative = loss. Show ALL positions regardless of P&L"
                      example: 1290.52
                    leverage:
                      type: number
                      description: "Position leverage"
                      example: 10.0
                    marginMode:
                      type: string
                      description: "Margin mode"
                      example: "isolated"
                    realizedPnl:
                      type: number
                      description: "Realized profit/loss"
                    notional:
                      type: number
                      description: "Position value in USDT"

  /api/live/all-exchanges:
    get:
      description: Get live positions and orders from all exchanges (BingX & Blofin)
      operationId: getAllExchangeData
      responses:
        '200':
          description: Live exchange data
          content:
            application/json:
              schema:
                type: object
                properties:
                  timestamp:
                    type: string
                  exchanges:
                    type: object
                    properties:
                      bingx:
                        type: object
                        properties:
                          status:
                            type: string
                          positions:
                            type: object
                            additionalProperties: true
                          orders:
                            type: object
                            additionalProperties: true
                      blofin:
                        type: object
                        properties:
                          status:
                            type: string
                          positions:
                            type: array
                            items:
                              type: object
                              additionalProperties: true
                          orders:
                            type: array
                            items:
                              type: object
                              additionalProperties: true

  /api/live/account-balances:
    get:
      description: Get account balances from all exchanges
      operationId: getAccountBalances
      responses:
        '200':
          description: Account balances
          content:
            application/json:
              schema:
                type: object
                properties:
                  timestamp:
                    type: string
                  balances:
                    type: object
                    properties:
                      bingx:
                        type: object
                        properties:
                          status:
                            type: string
                          data:
                            type: object
                            additionalProperties: true
                      blofin:
                        type: object
                        properties:
                          status:
                            type: string
                          data:
                            type: object
                            additionalProperties: true

  /api/live/bingx-positions:
    get:
      description: "DEPRECATED - Use /api/positions/bingx instead for direct array format"
      operationId: getBingXPositionsNestedDeprecated
      deprecated: true
      responses:
        '200':
          description: BingX positions and orders
          content:
            application/json:
              schema:
                type: object
                properties:
                  timestamp:
                    type: string
                  source:
                    type: string
                  positions:
                    type: object
                    properties:
                      code:
                        type: integer
                      data:
                        type: object
                        properties:
                          positions:
                            type: array
                            items:
                              type: object
                              additionalProperties: true
                  orders:
                    type: object
                    properties:
                      code:
                        type: integer
                      data:
                        type: object
                        properties:
                          orders:
                            type: array
                            items:
                              type: object
                              properties:
                                symbol:
                                  type: string
                                positionSide:
                                  type: string
                                leverage:
                                  type: string
                                status:
                                  type: string
                                avgPrice:
                                  type: string
                                stopLoss:
                                  type: object
                                  additionalProperties: true
                                takeProfit:
                                  type: object
                                  additionalProperties: true

  /api/live/blofin-positions:
    get:
      description: Get live positions from Blofin exchange
      operationId: getBlofinPositions
      responses:
        '200':
          description: Blofin positions and orders
          content:
            application/json:
              schema:
                type: object
                properties:
                  timestamp:
                    type: string
                  source:
                    type: string
                  positions:
                    type: array
                    items:
                      type: object
                      additionalProperties: true
                  orders:
                    type: array
                    items:
                      type: object
                      additionalProperties: true

  /api/live/market-data/{symbol}:
    get:
      description: Get live market data for a specific symbol
      operationId: getMarketData
      parameters:
        - name: symbol
          in: path
          required: true
          schema:
            type: string
          description: Trading symbol (e.g., BTC-USDT)
      responses:
        '200':
          description: Live market data
          content:
            application/json:
              schema:
                type: object
                properties:
                  timestamp:
                    type: string
                  symbol:
                    type: string
                  market_data:
                    type: object
                    properties:
                      blofin:
                        type: object
                        properties:
                          status:
                            type: string
                          ticker:
                            type: object
                            additionalProperties: true
                          orderbook:
                            type: object
                            additionalProperties: true

  /api/bingx/klines/{symbol}:
    get:
      description: Get BingX candlestick/OHLCV data for technical analysis
      operationId: getBingXKlines
      parameters:
        - name: symbol
          in: path
          required: true
          schema:
            type: string
          description: Trading symbol (e.g., BTC-USDT)
        - name: interval
          in: query
          required: false
          schema:
            type: string
            enum: ["1m", "3m", "5m", "15m", "30m", "1h", "2h", "4h", "6h", "8h", "12h", "1d", "3d", "1w", "1M"]
            default: "1h"
          description: Kline interval
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 100
            minimum: 1
            maximum: 1000
          description: Number of candlesticks to fetch
        - name: raw
          in: query
          required: false
          schema:
            type: string
            enum: ["true", "false"]
            default: "false"
          description: Return raw JSON string for better compatibility
      responses:
        '200':
          description: BingX candlestick data
          content:
            application/json:
              schema:
                type: object
                properties:
                  timestamp:
                    type: string
                  symbol:
                    type: string
                  interval:
                    type: string
                  limit:
                    type: integer
                  klines:
                    type: object
                    properties:
                      code:
                        type: integer
                      data:
                        type: array
                        items:
                          type: object
                          properties:
                            open_time:
                              type: integer
                            open_time_readable:
                              type: string
                            open:
                              type: number
                            high:
                              type: number
                            low:
                              type: number
                            close:
                              type: number
                            volume:
                              type: number
                            close_time:
                              type: integer
                            close_time_readable:
                              type: string

  /api/bingx/market-analysis/{symbol}:
    get:
      description: Get comprehensive BingX market data with 24hr ticker and analysis
      operationId: getBingXMarketAnalysis
      parameters:
        - name: symbol
          in: path
          required: true
          schema:
            type: string
          description: Trading symbol (e.g., BTC-USDT)
        - name: raw
          in: query
          required: false
          schema:
            type: string
            enum: ["true", "false"]
            default: "false"
          description: Return raw JSON string
      responses:
        '200':
          description: Comprehensive market analysis
          content:
            application/json:
              schema:
                type: object
                properties:
                  timestamp:
                    type: string
                  symbol:
                    type: string
                  market_analysis:
                    type: object
                    properties:
                      current_price:
                        type: number
                      24h_change:
                        type: number
                      24h_change_percent:
                        type: number
                      24h_high:
                        type: number
                      24h_low:
                        type: number
                      24h_volume:
                        type: number
                      price_trend:
                        type: string
                      volume_trend:
                        type: string

  /api/bingx/candlestick-analysis/{symbol}:
    get:
      description: Get BingX candlestick pattern analysis and trading signals
      operationId: getBingXCandlestickAnalysis
      parameters:
        - name: symbol
          in: path
          required: true
          schema:
            type: string
          description: Trading symbol (e.g., BTC-USDT)
        - name: interval
          in: query
          required: false
          schema:
            type: string
            enum: ["15m", "30m", "1h", "2h", "4h", "6h", "12h", "1d"]
            default: "1h"
          description: Analysis timeframe
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 50
            minimum: 20
            maximum: 200
          description: Number of candlesticks to analyze
      responses:
        '200':
          description: Candlestick pattern analysis and signals
          content:
            application/json:
              schema:
                type: object
                properties:
                  timestamp:
                    type: string
                  symbol:
                    type: string
                  interval:
                    type: string
                  technical_signals:
                    type: object
                    properties:
                      trend_signal:
                        type: string
                        enum: ["bullish", "bearish", "neutral"]
                      price_vs_sma20:
                        type: string
                      momentum:
                        type: string
                      support_level:
                        type: number
                      resistance_level:
                        type: number
                  trend_analysis:
                    type: object
                    properties:
                      recent_bullish_candles:
                        type: integer
                      recent_bearish_candles:
                        type: integer
                      momentum:
                        type: string
                      volatility:
                        type: string

  /api/bingx/multi-timeframe/{symbol}:
    get:
      description: Get multi-timeframe technical analysis across different intervals
      operationId: getBingXMultiTimeframeAnalysis
      parameters:
        - name: symbol
          in: path
          required: true
          schema:
            type: string
          description: Trading symbol (e.g., BTC-USDT)
        - name: raw
          in: query
          required: false
          schema:
            type: string
            enum: ["true", "false"]
            default: "false"
          description: Return raw JSON string
      responses:
        '200':
          description: Multi-timeframe analysis
          content:
            application/json:
              schema:
                type: object
                properties:
                  timestamp:
                    type: string
                  symbol:
                    type: string
                  timeframes:
                    type: object
                    properties:
                      15m:
                        type: object
                        additionalProperties: true
                      1h:
                        type: object
                        additionalProperties: true
                      4h:
                        type: object
                        additionalProperties: true
                      1d:
                        type: object
                        additionalProperties: true
                  overall_assessment:
                    type: object
                    properties:
                      bullish_timeframes:
                        type: integer
                      bearish_timeframes:
                        type: integer
                      neutral_timeframes:
                        type: integer
                      overall_trend:
                        type: string
                        enum: ["bullish", "bearish", "neutral"]
                      confidence:
                        type: number
                        minimum: 0
                        maximum: 1

  /api/kraken/positions:
    get:
      description: Get enhanced Kraken positions with comprehensive analytics including USD values, entry analysis, and time in trade
      operationId: getKrakenPositions
      responses:
        '200':
          description: Enhanced Kraken positions with detailed analytics
          content:
            application/json:
              schema:
                type: object
                properties:
                  timestamp:
                    type: string
                  source:
                    type: string
                  total_positions:
                    type: integer
                  total_portfolio_value:
                    type: number
                  positions:
                    type: array
                    items:
                      type: object
                      properties:
                        symbol:
                          type: string
                        side:
                          type: string
                        contracts:
                          type: number
                        entryPrice:
                          type: number
                        markPrice:
                          type: number
                        unrealizedPnl:
                          type: number
                        percentage:
                          type: number
                        enhanced_data:
                          type: object
                          properties:
                            token_amount:
                              type: number
                            usd_value:
                              type: number
                            entry_price_calculated:
                              type: number
                            current_price:
                              type: number
                            unrealized_pnl_usd:
                              type: number
                            pnl_percentage:
                              type: number
                            time_in_trade:
                              type: string
                            trade_count:
                              type: integer
                            avg_trade_size:
                              type: number
                            total_fees_paid:
                              type: number

  /api/kraken/balance:
    get:
      description: Get Kraken account balance with USD valuations and portfolio breakdown
      operationId: getKrakenBalance
      responses:
        '200':
          description: Kraken account balance with detailed breakdown
          content:
            application/json:
              schema:
                type: object
                properties:
                  timestamp:
                    type: string
                  source:
                    type: string
                  total_fiat_balance:
                    type: number
                  total_crypto_value:
                    type: number
                  total_portfolio_value:
                    type: number
                  balances:
                    type: object
                    additionalProperties:
                      type: object
                      properties:
                        free:
                          type: number
                        used:
                          type: number
                        total:
                          type: number
                        usd_value:
                          type: number
                        percentage_of_portfolio:
                          type: number
                  top_holdings:
                    type: array
                    items:
                      type: object
                      properties:
                        symbol:
                          type: string
                        amount:
                          type: number
                        usd_value:
                          type: number
                        percentage:
                          type: number

  /api/kraken/trade-history:
    get:
      description: Get comprehensive Kraken trade history with performance analytics and entry/exit analysis
      operationId: getKrakenTradeHistory
      parameters:
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 50
            minimum: 10
            maximum: 500
          description: Number of trades to fetch (10-500)
        - name: symbol
          in: query
          required: false
          schema:
            type: string
          description: Filter by specific symbol (e.g., BTC/USD)
        - name: days_back
          in: query
          required: false
          schema:
            type: integer
            default: 30
            minimum: 1
            maximum: 365
          description: Look back X days for trade history
      responses:
        '200':
          description: Comprehensive trade history with analytics
          content:
            application/json:
              schema:
                type: object
                properties:
                  timestamp:
                    type: string
                  total_trades:
                    type: integer
                  date_range:
                    type: string
                  summary_stats:
                    type: object
                    properties:
                      total_volume_usd:
                        type: number
                      total_fees_paid:
                        type: number
                      average_trade_size:
                        type: number
                      most_traded_symbol:
                        type: string
                      trading_frequency:
                        type: string
                  trades:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        symbol:
                          type: string
                        side:
                          type: string
                        amount:
                          type: number
                        price:
                          type: number
                        cost:
                          type: number
                        fee:
                          type: number
                        timestamp:
                          type: string
                        datetime:
                          type: string
                        age_days:
                          type: integer
                  symbol_breakdown:
                    type: object
                    additionalProperties:
                      type: object
                      properties:
                        trade_count:
                          type: integer
                        total_volume:
                          type: number
                        avg_price:
                          type: number
                        total_fees:
                          type: number

  /api/kraken/orders:
    get:
      description: Get Kraken open orders with detailed order book analysis
      operationId: getKrakenOrders
      responses:
        '200':
          description: Kraken open orders with analysis
          content:
            application/json:
              schema:
                type: object
                properties:
                  timestamp:
                    type: string
                  source:
                    type: string
                  total_orders:
                    type: integer
                  orders:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        symbol:
                          type: string
                        type:
                          type: string
                        side:
                          type: string
                        amount:
                          type: number
                        price:
                          type: number
                        stopPrice:
                          type: number
                        status:
                          type: string
                        timestamp:
                          type: string
                        datetime:
                          type: string
                        remaining:
                          type: number
                        filled:
                          type: number
                        fee:
                          type: number
                  order_analysis:
                    type: object
                    properties:
                      buy_orders:
                        type: integer
                      sell_orders:
                        type: integer
                      stop_orders:
                        type: integer
                      limit_orders:
                        type: integer
                      total_order_value:
                        type: number

  /api/kraken/market-data/{symbol}:
    get:
      description: Get Kraken market data for specific symbol including ticker, orderbook, and recent trades
      operationId: getKrakenMarketData
      parameters:
        - name: symbol
          in: path
          required: true
          schema:
            type: string
          description: Trading symbol (e.g., BTC/USD, ETH/USD)
      responses:
        '200':
          description: Kraken market data for symbol
          content:
            application/json:
              schema:
                type: object
                properties:
                  timestamp:
                    type: string
                  symbol:
                    type: string
                  ticker:
                    type: object
                    properties:
                      last:
                        type: number
                      bid:
                        type: number
                      ask:
                        type: number
                      high:
                        type: number
                      low:
                        type: number
                      volume:
                        type: number
                      change:
                        type: number
                      percentage:
                        type: number
                  orderbook:
                    type: object
                    properties:
                      bids:
                        type: array
                        items:
                          type: array
                          items:
                            type: number
                      asks:
                        type: array
                        items:
                          type: array
                          items:
                            type: number
                      spread:
                        type: number
                      spread_percentage:
                        type: number

  /api/bingx/balance:
    get:
      description: Get BingX account balance with enhanced analytics
      operationId: getBingXBalance
      responses:
        '200':
          description: BingX balance with detailed analysis
          content:
            application/json:
              schema:
                type: object
                properties:
                  timestamp:
                    type: string
                  source:
                    type: string
                  balance:
                    type: object
                    additionalProperties: true

  /api/alpha/scan-opportunities:
    get:
      description: Scan entire market for alpha opportunities with AI analysis
      operationId: scanAlphaOpportunities
      responses:
        '200':
          description: Alpha opportunities found in market
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  opportunities:
                    type: array
                    items:
                      type: object
                      additionalProperties: true
                  scan_time:
                    type: string
                  total_found:
                    type: integer
                  scan_type:
                    type: string

  /api/alpha/real-market-scan:
    get:
      description: Real-time market scanning for high-confidence trading opportunities
      operationId: realMarketScan
      responses:
        '200':
          description: Real market scan results with actionable insights
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  opportunities:
                    type: array
                    items:
                      type: object
                      additionalProperties: true
                  scan_time:
                    type: string
                  total_found:
                    type: integer
                  scan_type:
                    type: string

  /exchanges/status:
    get:
      description: Get status and health of all integrated exchanges
      operationId: getExchangesStatus
      responses:
        '200':
          description: Status of all exchanges
          content:
            application/json:
              schema:
                type: object
                properties:
                  exchanges:
                    type: object
                    additionalProperties: true
                  status:
                    type: string

  /api/news/crypto:
    get:
      description: Get latest cryptocurrency news with AI-powered analysis
      operationId: getCryptoNews
      parameters:
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
          description: Number of articles to fetch
        - name: symbol
          in: query
          required: false
          schema:
            type: string
          description: Filter news for specific cryptocurrency symbol
      responses:
        '200':
          description: Latest crypto news with sentiment analysis
          content:
            application/json:
              schema:
                type: object
                properties:
                  timestamp:
                    type: string
                  total_articles:
                    type: integer
                  articles:
                    type: array
                    items:
                      type: object
                      properties:
                        title:
                          type: string
                        description:
                          type: string
                        url:
                          type: string
                        source:
                          type: string
                        published_at:
                          type: string
                        sentiment:
                          type: string
                          enum: ["positive", "negative", "neutral"]
                        relevance_score:
                          type: number
                        tickers:
                          type: array
                          items:
                            type: string

  /api/chatgpt/analyze/{symbol}:
    get:
      description: Advanced ChatGPT-powered analysis for any cryptocurrency symbol
      operationId: chatgptAnalyzeSymbol
      parameters:
        - name: symbol
          in: path
          required: true
          schema:
            type: string
          description: Cryptocurrency symbol (e.g., BTC, ETH, XRP)
        - name: timeframe
          in: query
          required: false
          schema:
            type: string
            enum: ["1h", "4h", "1d", "1w"]
            default: "4h"
          description: Analysis timeframe
      responses:
        '200':
          description: Comprehensive AI-powered analysis
          content:
            application/json:
              schema:
                type: object
                properties:
                  symbol:
                    type: string
                  timeframe:
                    type: string
                  analysis:
                    type: object
                    properties:
                      price_action:
                        type: object
                        additionalProperties: true
                      technical_indicators:
                        type: object
                        additionalProperties: true
                      market_sentiment:
                        type: object
                        additionalProperties: true
                      risk_assessment:
                        type: object
                        additionalProperties: true
                      trading_recommendation:
                        type: string
                      confidence_score:
                        type: number
                        minimum: 0
                        maximum: 100